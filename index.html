<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
		<meta name="description" content="Want a clear map of bus lines around Eindhoven">
		<meta name="author" content="Guus Westendorp">
		<link rel="icon" href="../../favicon.ico">

		<title>Visual Buslines</title>

		<!-- Bootstrap core CSS -->
		<link href="dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">

		<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
		<link href="assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet" type="text/css">

		<!-- Custom styles for this template -->
		<link href="navbar.css" rel="stylesheet" type="text/css">

		<!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
		<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
		<!--<script src="/assets/js/ie-emulation-modes-warning.js"></script>-->

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>

	<body>
		<div class="container">
			<!-- Static navbar -->
			<nav class="navbar navbar-default">
				<div class="container-fluid">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="index.html">Visual Buslines</a>
					</div>
					<div id="navbar" class="navbar-collapse collapse">
						<ul class="nav navbar-nav">
							<li><a href="index.html">Home</a></li>
							<li class="active"><a href="map.html">Map</a></li>
							<li><a href="about.html">About</a></li>
							<li><a href="contact.html">Contact</a></li>
							<!--
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
								<ul class="dropdown-menu">
									<li><a href="#">Action</a></li>
									<li><a href="#">Another action</a></li>
									<li><a href="#">Something else here</a></li>
									<li role="separator" class="divider"></li>
									<li class="dropdown-header">Nav header</li>
									<li><a href="#">Separated link</a></li>
									<li><a href="#">One more separated link</a></li>
								</ul>
							</li>
							-->
						</ul>
						<!--
						<ul class="nav navbar-nav navbar-right">
							<li class="active"><a href="./">Default <span class="sr-only">(current)</span></a></li>
							<li><a href="../navbar-static-top/">Static top</a></li>
							<li><a href="../navbar-fixed-top/">Fixed top</a></li>
						</ul>
						-->
					</div><!--/.nav-collapse -->
				</div><!--/.container-fluid -->
			</nav>
			<div id="maincontent" class="container" style="height:100%;width:100%;">
				<div id="map"></div>
				<div id="buslist">
					<h1>Bus Lines</h1>
					<select id="lineoption">
						<option value="empty"></option>
					</select>
					<button id="addline">Add Line</button>
					<div id="itemlist">
						
					</div>
				</div>
			</div>
			<footer class="footer">
				<div class="container" id="footer">
					<p class="text-muted">Made By: Guus Westendorp</p>
				</div>
			</footer>
		</div> <!-- /container -->

		<!-- jQuery import -->
		<script src="jquery-3.1.1.js"></script>

		<!-- Bootstrap core JavaScript
		================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script type="text/javascript">window.jQuery || document.write('<script src="assets/js/vendor/jquery.min.js"><\/script>')</script>
		<!--
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		-->
		<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
		<script src="/assets/js/ie10-viewport-bug-workaround.js"></script>
		
		<!-- Google maps api and setup -->
		<script src="mapoptions.js"></script>
		<script src="buslines.js"></script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXyiw3gwfcn8dz9lc0bGX2iABk7Z2rhVY&callback=initMap" async defer></script>
		<script>
			var map;
			var dir;
			var lines = [];
			var routes = [];
			
			$('#addline').click(function(){
				var i = 0;
				var abort = false;
				var value = $('#lineoption option:selected').val();
				var content = $('#lineoption option:selected').text();
				if(value === "empty"){
					console.log("no item added");
				}else{
					while(i<lines.length){
						if(lines[i] === value){
							abort = true;
						}
						i++;
					}
					if(!abort){
						$('#itemlist').append('<div onclick="clickitem('+value+');" class="item" id="item'+value+'">'+content+'<button class="removebutton" onclick="removeitem('+value+');">remove</button><ul>');
						var divname = '#item'+value;
						for(k = 0; k < busnames.length; k++){
							if(busnames[k].substring(0,3) == value){
								waypoints = buslines[k].waypoints;
								for(l = 0; l < waypoints.length; l++){
									$(divname).append('<li class=listitem'+value+'>'+waypoints[l].location+'</li>');
								}
							}
						}
						$(divname).append('</ul>');
						$('#itemlist').append('</div>');
						var itemclass = '.listitem'+value;
						$(itemclass).hide();
						lines.push(value);
					}
				}
				console.log("List of line numbers: " + lines);
				showCorrectLines();
			});
			
			function removeitem(item){
				console.log("removing item: " + item);
				var i = 0;
				while(i<lines.length){
					console.log("removing: " + lines[i] + " : " + item + " : " + lines.indexOf(item));
					if(lines[i] == item){
						lines.splice(i,1);
					}else{
						i++;
					}
				}
				console.log("List of line numbers: " + lines);
				var name = '#item' + item;
				$(name).remove();
				for(i = 0; i < routes.length; i++){
					routes[i].setMap(null);
				}
				routes = new Array();
				showCorrectLines();
			}
			
			function clickitem(item){
				console.log("clicked: " + item);
				var div = '#item' + item;
				var listitems = '.listitem' + item;
				$(listitems).slideToggle("slow", function(){
					//$(listitems).show();
				});
			};
			
			function resizemaincontent(){
				var borderheights = 0.0;
				borderheights += parseInt($('nav').css('border-top-width').replace('px','')); //nav top border
				borderheights += parseInt($('nav').css('border-bottom-width').replace('px','')); //nav bottom border
				var height = $(window).height() - $('nav').height() - $('footer').height() -  borderheights;
				console.log($(document).width());
				$('#maincontent').css('height',height);
				var width = parseInt($('#maincontent').css('width').replace('px',''));
				$('#footer').css('width',width);
				if($(document).width() < 1000){
					$('#map').css('height',height/2);
					$('#map').css('width','100%');
					$('#buslist').css('height',height/2);
					$('#buslist').css('width','100%');
					var width = parseInt($('#maincontent').css('width').replace('px',''));
					$('#footer').css('width',width);
				}else{
					$('#map').css('height',height);
					$('#map').css('width','70%');
					$('#buslist').css('height',height);
					$('#buslist').css('width','30%');
				}
			}
			
			function initMap() {
				resizemaincontent();
				$(window).resize(function(){
					resizemaincontent();
				});
				// Create a map object and specify the DOM element for display.
				map = new google.maps.Map(document.getElementById('map'), {
					center: {lat: 51.4867272, lng: 5},
					scrollwheel: true,
					zoom: 9,
					styles: options
				});
				dir = new google.maps.DirectionsService();
				
				createLines(google.maps.UnitSystem.METRIC);
				addLinesToSelect();
				
				google.maps.event.trigger(map, "resize");
			}
			
			function display(line){
				directionsDisplay = new google.maps.DirectionsRenderer();
				routes.push(directionsDisplay);
				directionsDisplay.setMap(map);
				directionsDisplay.setDirections(line);
				google.maps.event.trigger(map, "resize");
			}
			
			function showCorrectLines(){
				var correctLines = [];
				for(i = 0; i < busnames.length; i++){
					for(j = 0; j < lines.length; j++){
						console.log("Checking for: " + busnames[i].substring(0,3) + " and " + lines[j]);
						if(busnames[i].substring(0,3) == lines[j]){
							correctLines.push(buslines[i]);
						}
					}
				}
				console.log("Amount of lines that should be displayed: " + correctLines);
				if(correctLines.length > 0){
					showLine(correctLines);
				}else{
					for(i = 0; i < routes.length; i++){
						routes[i].setMap(null);
					}
					routes = new Array();
					google.maps.event.trigger(map, "resize");
				}
			}
			
			function showLine(linelist){
				console.log("Creating bus line from " + linelist[0].origin + " to " + linelist[0].destination);
				dir.route(linelist[0],function(response,status){
					if (status == 'OK') {
						display(response);
						linelist.splice(0, 1);
						if (linelist.length > 0){
							showLine(linelist);
						}
					}
				});
			}
			
			function addLinesToSelect(){
				for(i = 0; i < buslines.length; i++){
					var line = buslines[i];
					var waypoints = line.waypoints;
					var begin = line.origin;
					var end = line.destination;
					var number = busnames[i].substring(0,3);
					$('#lineoption').append('<option value="'+number+'">'+number+' '+begin+' - '+end+'</option>');
				}
			}

		</script>
		
		<!-- http bulsines shizzle 
		<script type="text/javascript">
			function httpGetAsync(theUrl, callback)
			{
				var xmlHttp = new XMLHttpRequest();
				xmlHttp.onreadystatechange = function() { 
					if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
						callback(xmlHttp.responseText);
				}
				xmlHttp.open("GET", theUrl, true); // true for asynchronous 
				xmlHttp.send(null);
			}
			
			httpGetAsync("http://api.ovstatus.nl/stadstreek/haltes.php",null);
		</script>
		-->
	</body>
</html>
